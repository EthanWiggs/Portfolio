const INCOMER_TYPES=[{partID:"PB3153/ICM",name:"400A 3 POLE PANEL BOARD INCOMER",cost:400},{partID:"PB3154/ICM",name:"400A 4 POLE PANEL BOARD INCOMER",cost:400},{partID:"PB4003/ICM",name:"400A 3 POLE PANEL BOARD INCOMER",cost:400},{partID:"PB4004/ICM",name:"400A 4 POLE PANEL BOARD INCOMER",cost:400},{partID:"PB3154/ICS",name:"400A 4 POLE PANEL BOARD SWITCH INCOMER",cost:400}],SPINE_TYPES=[{partID:"PB400/06",name:"400A PANEL BOARD 6TP WAYS",max:6,cost:400},{partID:"PB400/06+2",name:"400A PANEL BOARD 6+2 TP WAYS",max:6,supportsLargeOutgoer:!0,cost:400},{partID:"PB400/08",name:"400A PANEL BOARD 8TP WAYS",max:8,cost:400},{partID:"PB400/08+2",name:"400A PANEL BOARD 8+2 TP WAYS",max:8,supportsLargeOutgoer:!0,cost:400},{partID:"PB400/12",name:"400A PANEL BOARD 12TP WAY",max:12,cost:400},{partID:"PB400/12+2",name:"400A PANEL BOARD 12+2 TP WAY",max:12,supportsLargeOutgoer:!0,cost:400},{partID:"PB400/16",name:"400A PANEL BOARD 16TP WAY",max:16,cost:400},{partID:"PB400/16+2",name:"400A PANEL BOARD 16+2 TP WAY",max:16,supportsLargeOutgoer:!0,cost:400}],OUTGOER_LESSTHAN_125A_TYPES=[{partID:"MC1P016",name:"MCCB 1P 16A",spaceRequired:1,cost:16},{partID:"MC1P020",name:"MCCB 1P 20A",spaceRequired:1,cost:20},{partID:"MC1P025",name:"MCCB 1P 25A",spaceRequired:1,cost:25},{partID:"MC1P032",name:"MCCB 1P 32A",spaceRequired:1,cost:32},{partID:"MC1P040",name:"MCCB 1P 40A",spaceRequired:1,cost:40},{partID:"MC1P050",name:"MCCB 1P 50A",spaceRequired:1,cost:50},{partID:"MC1P063",name:"MCCB 1P 63A",spaceRequired:1,cost:63},{partID:"MC1P080",name:"MCCB 1P 80A",spaceRequired:1,cost:80},{partID:"MC1P100",name:"MCCB 1P 100A",spaceRequired:1,cost:100},{partID:"MC1P125",name:"MCCB 1P 125A",spaceRequired:1,cost:125},{partID:"MC3P025",name:"MCCB 3P 25A",spaceRequired:3,cost:25},{partID:"MC3P040",name:"MCCB 3P 40A",spaceRequired:3,cost:40},{partID:"MC3P063",name:"MCCB 3P 63A",spaceRequired:3,cost:63},{partID:"MC3P100",name:"MCCB 3P 100A",spaceRequired:3,cost:100},{partID:"MC3P125",name:"MCCB 3P 125A",spaceRequired:3,cost:125}],OUTGOER_125A_OR_MORE_TYPES=[{partID:"MC3P160",name:"MCCB 3P 160A",cost:160},{partID:"MC3P200",name:"MCCB 3P 200A",cost:200},{partID:"MC3P250",name:"MCCB 3P 250A",cost:250}],ACCESSORIES=[{partID:"PB/SPD-100KA",name:"SURGE KIT TYPE 1+2",cost:100},{partID:"PB400-MID",name:"SINGLE METER KIT",cost:50},{partID:"PB/KL",name:"KEY LOCK",cost:25},{partID:"PB400/AB",name:"TYPE A ACCESSORY BOX",cost:75},{partID:"PB400/EB",name:"EXTENSION BOX",cost:75}],PICKERS=[{id:"c1",title:"Incomer – Choose one only",type:"single",palette:INCOMER_TYPES},{id:"c2",title:"Spine – Choose one only",type:"single",palette:SPINE_TYPES},{id:"c3",title:"Outgoer > 125A - Maximum 2 Units",type:"multi",max:2,palette:OUTGOER_125A_OR_MORE_TYPES,allowQuantity:!0},{id:"c4",title:"Outgoer ≤ 125A",type:"multi",max:18,palette:OUTGOER_LESSTHAN_125A_TYPES,allowQuantity:!0},{id:"c5",title:"Accessories",type:"multi",max:7,palette:ACCESSORIES}],state={c1:[],c2:[],c3:[],c4:[],c5:[]};PICKERS.forEach((t=>{t.allowQuantity&&(state[`${t.id}_qty`]={})}));const pickersRoot=document.getElementById("pickers"),productDiv=document.querySelector(".product"),downloadBtn=document.getElementById("download"),resetBtn=document.getElementById("reset"),C3_UNIT_CAP=2,$=(t,e=document)=>e.querySelector(t),$$=(t,e=document)=>Array.from(e.querySelectorAll(t)),el=(t,e={})=>{const a=document.createElement(t);return Object.entries(e).forEach((([t,e])=>{"class"===t?a.className=e:"dataset"===t?Object.assign(a.dataset,e):"text"===t?a.textContent=e:a.setAttribute(t,e)})),a};function findPaletteEntryByPartID(t,e){return Array.isArray(t)&&t.find((t=>t.partID===e||t.partId===e||t.id===e))||null}function getTotalPorts(){const t=state.c2[0];if(!t)return 18;const e=findPaletteEntryByPartID(SPINE_TYPES,t);return e&&e.max?3*e.max:18}function calculateUsedPortsForC4Model(){if(!Array.isArray(state.c4))return 0;const t=state.c4_qty||{};return state.c4.reduce(((e,a)=>{const o=findPaletteEntryByPartID(OUTGOER_LESSTHAN_125A_TYPES,a);if(!o)return e;return e+("number"==typeof t[a]?t[a]:1)*(o.spaceRequired||1)}),0)}function getC3CurrentUnits(){if(!Array.isArray(state.c3))return 0;const t=state.c3_qty||{};return state.c3.reduce(((e,a)=>e+("number"==typeof t[a]?t[a]:1)),0)}function computeBlanksForRemaining(t){if(t<=0)return{triple:0,single:0,remaining:0};return{triple:Math.floor(t/3),single:t%3,remaining:t}}function updateBlanksDisplay(){if(!productDiv)return;if(productDiv.querySelectorAll('p[data-part-id="PB/TB-auto"], p[data-part-id="PB/SB-auto"]').forEach((t=>t.remove())),!state.c2[0])return;const t=computeBlanksForRemaining(Math.max(0,getTotalPorts()-calculateUsedPortsForC4Model()));if(t.triple>0){const e=el("p");e.dataset.partId="PB/TB-auto",e.dataset.spec="blanks",e.textContent=`TRIPLE POLE BLANK × ${t.triple}`,productDiv.appendChild(e)}if(t.single>0){const e=el("p");e.dataset.partId="PB/SB-auto",e.dataset.spec="blanks",e.textContent=`SINGLE POLE BLANK × ${t.single}`,productDiv.appendChild(e)}const e=pickersRoot.querySelector('section[data-spec="c5"]');if(!e)return;const a=e.querySelector(".auto-blanks-note");a&&a.remove();const o=el("div",{class:"auto-blanks-note"});o.textContent=`Required blanks: ${t.triple} triple pole(s), ${t.single} single pole(s)`,e.appendChild(o)}function ensureSpaceBar(){const t=pickersRoot.querySelector('section[data-spec="c4"]');if(!t)return;if(t.querySelector(".space-bar"))return;const e=el("div",{class:"space-bar"});e.appendChild(el("div",{class:"space-bar-fill"})),e.appendChild(el("div",{class:"space-bar-text"}));const a=t.querySelector(".swatch-grid");a?t.insertBefore(e,a):t.appendChild(e)}function updateSpaceBar(){const t=pickersRoot.querySelector('section[data-spec="c4"]');if(!t)return;ensureSpaceBar();const e=getTotalPorts(),a=calculateUsedPortsForC4Model(),o=Math.min(100,Math.round(a/(e||1)*100)),s=t.querySelector(".space-bar"),n=t.querySelector(".space-bar-fill"),c=t.querySelector(".space-bar-text");n&&s&&(n.style.setProperty("--fill",o+"%"),n.style.width=o+"%",s.classList.toggle("full",a>=e)),c&&(c.textContent=`${a}/${e} ports used`);const r=document.getElementById("count-c4");r&&(r.textContent=String(a));const d=pickersRoot.querySelector('section[data-spec="c4"]');if(d){const t=d.querySelector(".field-note span");t&&(t.innerHTML=`Used: <strong id="count-c4">${a}</strong> / ${e} ports`);const o=d.querySelector(".max-label");o&&(o.textContent=`Max selectable: ${e} ports`)}updateBlanksDisplay(),updateDownloadButtonState()}function createSwatchNode(t,e,a,o){const s=el("label",{class:"swatch",dataset:{partId:t}});s.dataset.checked="false";const n=el("input");n.type="checkbox",n.name=a,n.value=t,n.className="swatch-input";const c=el("span",{class:"tick"});c.textContent="✓";const r=el("span",{class:"swatch-label"});if(r.textContent=e,s.appendChild(n),s.appendChild(c),s.appendChild(r),o){const e=el("div",{class:"qty-wrap"}),o=el("button");o.type="button",o.className="qty-minus",o.textContent="−";const n=el("span",{class:"qty"});n.textContent="1",n.dataset.value="1";const c=el("button");c.type="button",c.className="qty-plus",c.textContent="+";const r=t=>{t.preventDefault(),t.stopPropagation()};o.addEventListener("click",(e=>{r(e),handleQtyClick(a,t,-1)})),c.addEventListener("click",(e=>{r(e),handleQtyClick(a,t,1)})),e.appendChild(o),e.appendChild(n),e.appendChild(c),s.appendChild(e)}return s}function renderPickers(){pickersRoot.innerHTML="",PICKERS.forEach((t=>{const e=el("hr");e.style.border="none",e.style.borderTop="1px solid var(--border)",e.style.margin="16px 0",pickersRoot.appendChild(e);const a=el("section");a.className="section",a.dataset.spec=t.id;const o=el("div",{class:"picker-heading"}),s=el("span",{class:"picker-title"});s.textContent=t.title;const n=el("img",{class:"picker-icon",src:`productImages/${t.title}.jpg`,alt:`${t.title} icon`});o.appendChild(s),o.appendChild(n),a.appendChild(o),"c4"===t.id&&a.appendChild(el("div",{class:"space-bar-placeholder"}));const c=el("div",{class:"swatch-grid"});(t.palette||[]).forEach((e=>{const a=createSwatchNode(e.partID,e.name,t.id,!!t.allowQuantity),o=state[t.id].includes(e.partID);a.dataset.checked=o?"true":"false";const s=a.querySelector("input");s.checked=o,o?a.classList.add("show-qty"):a.classList.remove("show-qty");const n=a.querySelector(".qty");if(n){const a=state[`${t.id}_qty`]&&"number"==typeof state[`${t.id}_qty`][e.partID]?state[`${t.id}_qty`][e.partID]:1;n.dataset.value=String(a),n.textContent=String(a)}s.addEventListener("change",(()=>handleCheckboxChange(t,e,s,a,c))),c.appendChild(a)})),a.appendChild(c);const r=el("div",{class:"field-note"}),d=el("span");if("c4"===t.id){const e=calculateUsedPortsForC4Model();d.innerHTML=`Used: <strong id="count-${t.id}">${e}</strong> / ${getTotalPorts()} ports`}else if("c3"===t.id){const e=getC3CurrentUnits();d.innerHTML=`Selected units: <strong id="count-${t.id}">${e}</strong> / ${C3_UNIT_CAP}`}else d.innerHTML=`Selected: <strong id="count-${t.id}">${state[t.id].length}</strong> / ${t.max||("multi"===t.type?2:1)}`;if(r.appendChild(d),"multi"===t.type){const e=el("div",{class:"max-label"});e.style.color="var(--muted)",e.style.fontSize="12px","c4"===t.id?e.textContent=`Max selectable: ${getTotalPorts()} ports`:"c3"===t.id?e.textContent=`Max units: ${C3_UNIT_CAP}`:e.textContent=`Max selectable: ${t.max||2}`,r.appendChild(e)}a.appendChild(r),pickersRoot.appendChild(a)})),updateSpaceBar(),updateBlanksDisplay(),updateCounters(),updateDownloadButtonState()}function handleCheckboxChange(t,e,a,o,s){const n=e.partID;if("single"===t.type)if(a.checked){state[t.id]=[n],s.querySelectorAll(".swatch").forEach((e=>{const a=e.querySelector("input").value;if(a===n)e.dataset.checked="true",e.querySelector("input").checked=!0,e.classList.add("show-qty");else{e.dataset.checked="false",e.querySelector("input").checked=!1,e.classList.remove("show-qty"),productDiv.querySelectorAll(`p[data-part-id="${a}"]`).forEach((t=>t.remove())),t.allowQuantity&&(state[`${t.id}_qty`][a]=void 0);const o=e.querySelector(".qty");o&&(o.dataset.value="1",o.textContent="1")}})),productDiv.querySelectorAll(`p[data-spec="${t.id}"]`).forEach((t=>t.remove()));const a=t.allowQuantity&&state[`${t.id}_qty`][n]||1,o=el("p");o.dataset.partId=n,o.dataset.spec=t.id,o.textContent=t.allowQuantity?`${e.name} × ${a}`:e.name,productDiv.appendChild(o),t.allowQuantity&&(state[`${t.id}_qty`][n]=state[`${t.id}_qty`][n]||1)}else state[t.id]=[],productDiv.querySelectorAll(`p[data-spec="${t.id}"]`).forEach((t=>t.remove())),o.dataset.checked="false",o.classList.remove("show-qty"),t.allowQuantity&&(state[`${t.id}_qty`]={});else{const e=new Set(state[t.id]);if(a.checked){if("c4"===t.id){const e=findPaletteEntryByPartID(t.palette,n),o=e&&e.spaceRequired||1,s=getTotalPorts();if(calculateUsedPortsForC4Model()+o>s)return void(a.checked=!1)}else if("c3"===t.id){if(getC3CurrentUnits()+1>C3_UNIT_CAP)return void(a.checked=!1)}else if(e.size>=(t.max||2)){const a=state[t.id][0];e.delete(a);const o=s.querySelector(`.swatch[data-part-id="${a}"]`);if(o){o.dataset.checked="false",o.querySelector("input").checked=!1,o.classList.remove("show-qty");const e=document.querySelector(`.product p[data-part-id="${a}"]`);e&&e.remove(),t.allowQuantity&&(state[`${t.id}_qty`][a]=void 0);const s=o.querySelector(".qty");s&&(s.dataset.value="1",s.textContent="1")}}e.add(n),o.dataset.checked="true",o.classList.add("show-qty"),t.allowQuantity&&(state[`${t.id}_qty`][n]=state[`${t.id}_qty`][n]||1)}else{e.delete(n),o.dataset.checked="false",o.classList.remove("show-qty");const a=productDiv.querySelector(`p[data-part-id="${n}"]`);a&&a.remove(),t.allowQuantity&&(state[`${t.id}_qty`][n]=void 0);const s=o.querySelector(".qty");s&&(s.dataset.value="1",s.textContent="1")}state[t.id]=Array.from(e)}"c4"===t.id&&enforcePortsForC4(),"c3"===t.id&&getC3CurrentUnits()>C3_UNIT_CAP&&freeUpC3Units(C3_UNIT_CAP),updateCounters(),updateTotalCost(),"c2"===t.id&&(updateOutgoerAvailability(),enforcePortsForC4()),"c4"===t.id&&updateSpaceBar()}function handleQtyClick(t,e,a){const o=PICKERS.find((e=>e.id===t));if(!o||!o.allowQuantity)return;const s=pickersRoot.querySelector(`section[data-spec="${t}"] .swatch[data-part-id="${e}"]`);if(!s)return;const n=s.querySelector("input");if(!n.checked&&a>0)return n.checked=!0,void n.dispatchEvent(new Event("change",{bubbles:!0}));const c=state[`${t}_qty`]||{},r="number"==typeof c[e]?c[e]:1,d=r+a;if(d<=0)return n.checked=!1,void n.dispatchEvent(new Event("change",{bubbles:!0}));if("c4"===t){const t=findPaletteEntryByPartID(OUTGOER_LESSTHAN_125A_TYPES,e),a=t&&t.spaceRequired||1;if(calculateUsedPortsForC4Model()+(d-r)*a>getTotalPorts())return}else if("c3"===t){if(getC3CurrentUnits()+(d-r)>C3_UNIT_CAP)return}state[`${t}_qty`][e]=d;const l=s.querySelector(".qty");l&&(l.dataset.value=String(d),l.textContent=String(d));const i=document.querySelector(`.product p[data-part-id="${e}"]`);if(i){const t=findPaletteEntryByPartID(o.palette,e)||findPaletteEntryByPartID(OUTGOER_LESSTHAN_125A_TYPES,e)||findPaletteEntryByPartID(OUTGOER_125A_OR_MORE_TYPES,e);t&&(i.textContent=`${t.name} × ${d}`)}updateSpaceBar(),updateTotalCost(),updateCounters()}function freeUpC3Units(t){for(;getC3CurrentUnits()>t&&state.c3.length>0;){const t=state.c3.shift();state.c3_qty&&(state.c3_qty[t]=void 0);const e=document.querySelector(`.product p[data-part-id="${t}"]`);e&&e.remove();const a=pickersRoot.querySelector(`section[data-spec="c3"] .swatch[data-part-id="${t}"]`);if(a){const t=a.querySelector("input");t&&(t.checked=!1),a.dataset.checked="false",a.classList.remove("show-qty");const e=a.querySelector(".qty");e&&(e.dataset.value="1",e.textContent="1")}}}function enforcePortsForC4(){const t=getTotalPorts();let e=calculateUsedPortsForC4Model();for(;e>t&&state.c4.length>0;){const t=state.c4.shift();state.c4_qty&&(state.c4_qty[t]=void 0);const a=document.querySelector(`.product p[data-part-id="${t}"]`);a&&a.remove();const o=pickersRoot.querySelector(`section[data-spec="c4"] .swatch[data-part-id="${t}"]`);if(o){const t=o.querySelector("input");t&&(t.checked=!1),o.dataset.checked="false",o.classList.remove("show-qty");const e=o.querySelector(".qty");e&&(e.dataset.value="1",e.textContent="1")}e=calculateUsedPortsForC4Model()}updateCounters(),updateTotalCost(),updateDownloadButtonState()}function updateOutgoerAvailability(){const t=PICKERS.find((t=>"c3"===t.id)),e=pickersRoot.querySelector('section[data-spec="c3"]');if(!e||!t)return;const a=state.c2[0];let o=!1;if(a){const t=findPaletteEntryByPartID(SPINE_TYPES,a);t&&t.supportsLargeOutgoer&&(o=!0)}e.querySelectorAll(".swatch").forEach((t=>{if(o)t.classList.remove("disabled"),t.dataset.disabled="false";else{if("true"===t.dataset.checked){const e=t.querySelector("input");if(e){const a=e.value;e.checked=!1,t.dataset.checked="false";const o=document.querySelector(`.product p[data-part-id="${a}"]`);o&&o.remove()}}t.classList.add("disabled"),t.dataset.disabled="true"}})),o||(Array.isArray(state.c3)&&state.c3.forEach((t=>{state.c3_qty&&(state.c3_qty[t]=void 0)})),state.c3=[]),updateSpaceBar(),updateBlanksDisplay(),updateCounters(),updateDownloadButtonState()}function updateCounters(){PICKERS.forEach((t=>{const e=document.getElementById(`count-${t.id}`);e&&("c4"===t.id?e.textContent=String(calculateUsedPortsForC4Model()):"c3"===t.id?e.textContent=String(getC3CurrentUnits()):e.textContent=String(state[t.id].length))})),updateTotalCost()}function updateTotalCost(){let t=0;PICKERS.forEach((e=>{const a=e.palette||[];state[e.id].forEach((o=>{const s=findPaletteEntryByPartID(a,o);if(!s)return;let n=1;e.allowQuantity&&state[`${e.id}_qty`]&&(n=state[`${e.id}_qty`][o]||1),t+=(s.cost||0)*n}))}));const e=document.getElementById("total-cost");e&&(e.textContent=`Total Cost: £${t}`),updateDownloadButtonState()}function updateDownloadButtonState(){if(!downloadBtn)return;const t=calculateUsedPortsForC4Model(),e=getTotalPorts(),a=productDiv&&productDiv.querySelectorAll("p").length>0,o=t>e||!a;downloadBtn.disabled=o,downloadBtn.style.pointerEvents=o?"none":"",downloadBtn.style.opacity=o?"0.45":""}function downloadCSV(){if(!productDiv)return;if(calculateUsedPortsForC4Model()>getTotalPorts())return;const t=Array.from(productDiv.querySelectorAll("p")).map((t=>`"${t.textContent.replace(/\u00d7/g,"x")}"`)).join("\n"),e=new Blob([t],{type:"text/csv"}),a=URL.createObjectURL(e),o=el("a");o.href=a,o.download="products.csv",document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(a)}function resetApp(){state.c1=[],state.c2=[],state.c3=[],state.c4=[],state.c5=[],PICKERS.forEach((t=>{t.allowQuantity&&(state[`${t.id}_qty`]={})})),renderPickers(),productDiv&&(productDiv.innerHTML=""),updateOutgoerAvailability(),updateTotalCost(),updateDownloadButtonState()}resetBtn?.addEventListener("click",resetApp),downloadBtn?.addEventListener("click",downloadCSV),renderPickers(),updateOutgoerAvailability(),updateSpaceBar(),updateBlanksDisplay(),updateDownloadButtonState();
