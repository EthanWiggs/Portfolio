const INCOMER_TYPES=[{partID:"PB3153/ICM",name:"400A 3 POLE PANEL BOARD INCOMER",cost:400},{partID:"PB3154/ICM",name:"400A 4 POLE PANEL BOARD INCOMER",cost:400},{partID:"PB4003/ICM",name:"400A 3 POLE PANEL BOARD INCOMER",cost:400},{partID:"PB4004/ICM",name:"400A 4 POLE PANEL BOARD INCOMER",cost:400},{partID:"PB3154/ICS",name:"400A 4 POLE PANEL BOARD SWITCH INCOMER",cost:400}],SPINE_TYPES=[{partID:"PB400/06",name:"400A PANEL BOARD 6TP WAYS",max:6,cost:400},{partID:"PB400/06+2",name:"400A PANEL BOARD 6+2 TP WAYS",max:6,supportsLargeOutgoer:!0,cost:400},{partID:"PB400/08",name:"400A PANEL BOARD 8TP WAYS",max:8,cost:400},{partID:"PB400/08+2",name:"400A PANEL BOARD 8+2 TP WAYS",max:8,supportsLargeOutgoer:!0,cost:400},{partID:"PB400/12",name:"400A PANEL BOARD 12TP WAY",max:12,cost:400},{partID:"PB400/12+2",name:"400A PANEL BOARD 12+2 TP WAY",max:12,supportsLargeOutgoer:!0,cost:400},{partID:"PB400/16",name:"400A PANEL BOARD 16TP WAY",max:16,cost:400},{partID:"PB400/16+2",name:"400A PANEL BOARD 16+2 TP WAY",max:16,supportsLargeOutgoer:!0,cost:400}],OUTGOER_LESSTHAN_125A_TYPES=[{partID:"MC1P016",name:"MCCB 1P 16A",spaceRequired:1,cost:16},{partID:"MC1P020",name:"MCCB 1P 20A",spaceRequired:1,cost:20},{partID:"MC1P025",name:"MCCB 1P 25A",spaceRequired:1,cost:25},{partID:"MC1P032",name:"MCCB 1P 32A",spaceRequired:1,cost:32},{partID:"MC1P040",name:"MCCB 1P 40A",spaceRequired:1,cost:40},{partID:"MC1P050",name:"MCCB 1P 50A",spaceRequired:1,cost:50},{partID:"MC1P063",name:"MCCB 1P 63A",spaceRequired:1,cost:63},{partID:"MC1P080",name:"MCCB 1P 80A",spaceRequired:1,cost:80},{partID:"MC1P100",name:"MCCB 1P 100A",spaceRequired:1,cost:100},{partID:"MC1P125",name:"MCCB 1P 125A",spaceRequired:1,cost:125},{partID:"MC3P025",name:"MCCB 3P 25A",spaceRequired:3,cost:25},{partID:"MC3P040",name:"MCCB 3P 40A",spaceRequired:3,cost:40},{partID:"MC3P063",name:"MCCB 3P 63A",spaceRequired:3,cost:63},{partID:"MC3P100",name:"MCCB 3P 100A",spaceRequired:3,cost:100},{partID:"MC3P125",name:"MCCB 3P 125A",spaceRequired:3,cost:125}],OUTGOER_125A_OR_MORE_TYPES=[{partID:"MC3P160",name:"MCCB 3P 160A",cost:160},{partID:"MC3P200",name:"MCCB 3P 200A",cost:200},{partID:"MC3P250",name:"MCCB 3P 250A",cost:250},],ACCESSORIES=[{partID:"PB/SPD-100KA",name:"SURGE KIT TYPE 1+2",cost:100},{partID:"PB400-MID",name:"SINGLE METER KIT",cost:50},{partID:"PB/KL",name:"KEY LOCK",cost:25},{partID:"PB400/AB",name:"TYPE A ACCESSORY BOX",cost:75},{partID:"PB400/EB",name:"EXTENSION BOX",cost:75},],PICKERS=[{id:"c1",title:"Incomer – Choose one only",type:"single",palette:INCOMER_TYPES},{id:"c2",title:"Spine – Choose one only",type:"single",palette:SPINE_TYPES},{id:"c3",title:"Outgoer > 125A - Maximum 2 Units",type:"multi",max:2,palette:OUTGOER_125A_OR_MORE_TYPES,allowQuantity:!0},{id:"c4",title:"Outgoer ≤ 125A",type:"multi",max:18,palette:OUTGOER_LESSTHAN_125A_TYPES,allowQuantity:!0},{id:"c5",title:"Accessories",type:"multi",max:7,palette:ACCESSORIES},],state={c1:[],c2:[],c3:[],c4:[],c5:[]};PICKERS.forEach(t=>{t.allowQuantity&&(state[`${t.id}_qty`]={})});const pickersRoot=document.getElementById("pickers"),productDiv=document.querySelector(".product"),downloadBtn=document.getElementById("download"),resetBtn=document.getElementById("reset"),C3_UNIT_CAP=2,$=(t,e=document)=>e.querySelector(t),$$=(t,e=document)=>Array.from(e.querySelectorAll(t)),el=(t,e={})=>{let a=document.createElement(t);return Object.entries(e).forEach(([t,e])=>{"class"===t?a.className=e:"dataset"===t?Object.assign(a.dataset,e):"text"===t?a.textContent=e:a.setAttribute(t,e)}),a};function findPaletteEntryByPartID(t,e){return Array.isArray(t)&&t.find(t=>t.partID===e||t.partId===e||t.id===e)||null}function getTotalPorts(){let t=state.c2[0];if(!t)return 18;let e=findPaletteEntryByPartID(SPINE_TYPES,t);return e&&e.max?3*e.max:18}function calculateUsedPortsForC4Model(){if(!Array.isArray(state.c4))return 0;let t=state.c4_qty||{};return state.c4.reduce((e,a)=>{let r=findPaletteEntryByPartID(OUTGOER_LESSTHAN_125A_TYPES,a);if(!r)return e;let l="number"==typeof t[a]?t[a]:1;return e+l*(r.spaceRequired||1)},0)}function getC3CurrentUnits(){if(!Array.isArray(state.c3))return 0;let t=state.c3_qty||{};return state.c3.reduce((e,a)=>e+("number"==typeof t[a]?t[a]:1),0)}function computeBlanksForRemaining(t){return t<=0?{triple:0,single:0,remaining:0}:{triple:Math.floor(t/3),single:t%3,remaining:t}}function removeManualBlanksFromAccessories(){let t=["PB/TB","PB/SB"];state.c5=(state.c5||[]).filter(e=>!t.includes(e)),state.c5_qty&&t.forEach(t=>state.c5_qty[t]=void 0);let e=pickersRoot.querySelector('section[data-spec="c5"]');e&&e.querySelectorAll(".swatch").forEach(t=>{let e=t.querySelector("input");e&&("PB/TB"===e.value||"PB/SB"===e.value)&&(e.checked=!1,t.dataset.checked="false",t.classList.remove("show-qty"))})}function updateBlanksDisplay(){if(!productDiv||(productDiv.querySelectorAll('p[data-part-id="PB/TB-auto"], p[data-part-id="PB/SB-auto"]').forEach(t=>t.remove()),!state.c2[0]))return;removeManualBlanksFromAccessories();let t=Math.max(0,getTotalPorts()-calculateUsedPortsForC4Model()),e=computeBlanksForRemaining(t);if(e.triple>0){let a=el("p");a.dataset.partId="PB/TB-auto",a.dataset.spec="blanks",a.textContent=`TRIPLE POLE BLANK \xd7 ${e.triple}`,productDiv.appendChild(a)}if(e.single>0){let r=el("p");r.dataset.partId="PB/SB-auto",r.dataset.spec="blanks",r.textContent=`SINGLE POLE BLANK \xd7 ${e.single}`,productDiv.appendChild(r)}let l=pickersRoot.querySelector('section[data-spec="c5"]');if(!l)return;let s=l.querySelector(".auto-blanks-note");s&&s.remove();let o=el("div",{class:"auto-blanks-note"});o.textContent=`Required blanks: ${e.triple} triple pole(s), ${e.single} single pole(s)`,l.appendChild(o)}function ensureSpaceBar(){let t=pickersRoot.querySelector('section[data-spec="c4"]');if(!t||t.querySelector(".space-bar"))return;let e=el("div",{class:"space-bar"});e.appendChild(el("div",{class:"space-bar-fill"})),e.appendChild(el("div",{class:"space-bar-text"}));let a=t.querySelector(".swatch-grid");a?t.insertBefore(e,a):t.appendChild(e)}function updateSpaceBar(){let t=pickersRoot.querySelector('section[data-spec="c4"]');if(!t)return;ensureSpaceBar();let e=getTotalPorts(),a=calculateUsedPortsForC4Model(),r=Math.min(100,Math.round(a/(e||1)*100)),l=t.querySelector(".space-bar"),s=t.querySelector(".space-bar-fill"),o=t.querySelector(".space-bar-text");s&&l&&(s.style.setProperty("--fill",r+"%"),s.style.width=r+"%",l.classList.toggle("full",a>=e)),o&&(o.textContent=`${a}/${e} ports used`);let c=document.getElementById("count-c4");c&&(c.textContent=String(a));let n=pickersRoot.querySelector('section[data-spec="c4"]');if(n){let d=n.querySelector(".field-note span");d&&(d.innerHTML=`Used: <strong id="count-c4">${a}</strong> / ${e} ports`);let i=n.querySelector(".max-label");i&&(i.textContent=`Max selectable: ${e} ports`)}updateBlanksDisplay(),updateDownloadButtonState()}function createSwatchNode(t,e,a,r){let l=el("label",{class:"swatch",dataset:{partId:t}});l.dataset.checked="false";let s=el("input");s.type="checkbox",s.name=a,s.value=t,s.className="swatch-input";let o=el("span",{class:"tick"});o.textContent="✓";let c=el("span",{class:"swatch-label"});if(c.textContent=e,l.appendChild(s),l.appendChild(o),l.appendChild(c),r){let n=el("div",{class:"qty-wrap"}),d=el("button");d.type="button",d.className="qty-minus",d.textContent="−";let i=el("span",{class:"qty"});i.textContent="1",i.dataset.value="1";let p=el("button");p.type="button",p.className="qty-plus",p.textContent="+";let u=t=>{t.preventDefault(),t.stopPropagation()};d.addEventListener("click",e=>{u(e),handleQtyClick(a,t,-1)}),p.addEventListener("click",e=>{u(e),handleQtyClick(a,t,1)}),n.appendChild(d),n.appendChild(i),n.appendChild(p),l.appendChild(n)}return l}function renderPickers(){pickersRoot.innerHTML="",PICKERS.forEach(t=>{let e=el("hr");e.style.border="none",e.style.borderTop="1px solid var(--border)",e.style.margin="16px 0",pickersRoot.appendChild(e);let a=el("section");a.className="section",a.dataset.spec=t.id;let r=el("div",{class:"picker-heading"}),l=el("span",{class:"picker-title"});l.textContent=t.title;let s=el("img",{class:"picker-icon",src:`productImages/${t.title}.jpg`,alt:`${t.title} icon`});r.appendChild(l),r.appendChild(s),a.appendChild(r),"c4"===t.id&&a.appendChild(el("div",{class:"space-bar-placeholder"}));let o=el("div",{class:"swatch-grid"});(t.palette||[]).forEach(e=>{let a=createSwatchNode(e.partID,e.name,t.id,!!t.allowQuantity),r=state[t.id].includes(e.partID);a.dataset.checked=r?"true":"false";let l=a.querySelector("input");l.checked=r,r?a.classList.add("show-qty"):a.classList.remove("show-qty");let s=a.querySelector(".qty");if(s){let c=state[`${t.id}_qty`]&&"number"==typeof state[`${t.id}_qty`][e.partID]?state[`${t.id}_qty`][e.partID]:1;s.dataset.value=String(c),s.textContent=String(c)}l.addEventListener("change",()=>handleCheckboxChange(t,e,l,a,o)),o.appendChild(a)}),a.appendChild(o);let c=el("div",{class:"field-note"}),n=el("span");if("c4"===t.id){let d=calculateUsedPortsForC4Model();n.innerHTML=`Used: <strong id="count-${t.id}">${d}</strong> / ${getTotalPorts()} ports`}else if("c3"===t.id){let i=getC3CurrentUnits();n.innerHTML=`Selected units: <strong id="count-${t.id}">${i}</strong> / 2`}else n.innerHTML=`Selected: <strong id="count-${t.id}">${state[t.id].length}</strong> / ${t.max||("multi"===t.type?2:1)}`;if(c.appendChild(n),"multi"===t.type){let p=el("div",{class:"max-label"});p.style.color="var(--muted)",p.style.fontSize="12px","c4"===t.id?p.textContent=`Max selectable: ${getTotalPorts()} ports`:"c3"===t.id?p.textContent="Max units: 2":p.textContent=`Max selectable: ${t.max||2}`,c.appendChild(p)}a.appendChild(c),pickersRoot.appendChild(a)}),updateSpaceBar(),updateBlanksDisplay(),updateCounters(),updateDownloadButtonState()}function handleCheckboxChange(t,e,a,r,l){let s=e.partID;if("single"===t.type){if(a.checked){state[t.id]=[s],l.querySelectorAll(".swatch").forEach(e=>{let a=e.querySelector("input").value;if(a===s)e.dataset.checked="true",e.querySelector("input").checked=!0,e.classList.add("show-qty");else{e.dataset.checked="false",e.querySelector("input").checked=!1,e.classList.remove("show-qty"),productDiv.querySelectorAll(`p[data-part-id="${a}"]`).forEach(t=>t.remove()),t.allowQuantity&&(state[`${t.id}_qty`][a]=void 0);let r=e.querySelector(".qty");r&&(r.dataset.value="1",r.textContent="1")}}),productDiv.querySelectorAll(`p[data-spec="${t.id}"]`).forEach(t=>t.remove());let o=t.allowQuantity&&state[`${t.id}_qty`][s]||1,c=el("p");c.dataset.partId=s,c.dataset.spec=t.id,c.textContent=t.allowQuantity?`${e.name} \xd7 ${o}`:e.name,productDiv.appendChild(c),t.allowQuantity&&(state[`${t.id}_qty`][s]=state[`${t.id}_qty`][s]||1)}else state[t.id]=[],productDiv.querySelectorAll(`p[data-spec="${t.id}"]`).forEach(t=>t.remove()),r.dataset.checked="false",r.classList.remove("show-qty"),t.allowQuantity&&(state[`${t.id}_qty`]={})}else{let n=new Set(state[t.id]);if(a.checked){if("c4"===t.id){let d=findPaletteEntryByPartID(t.palette,s),i=d&&d.spaceRequired||1,p=getTotalPorts(),u=calculateUsedPortsForC4Model();if(u+i>p){a.checked=!1;return}}else if("c3"===t.id){let C=getC3CurrentUnits();if(C+1>2){a.checked=!1;return}}else if(n.size>=(t.max||2)){let y=state[t.id][0];n.delete(y);let P=l.querySelector(`.swatch[data-part-id="${y}"]`);if(P){P.dataset.checked="false",P.querySelector("input").checked=!1,P.classList.remove("show-qty");let S=document.querySelector(`.product p[data-part-id="${y}"]`);S&&S.remove(),t.allowQuantity&&(state[`${t.id}_qty`][y]=void 0);let f=P.querySelector(".qty");f&&(f.dataset.value="1",f.textContent="1")}}if(n.add(s),r.dataset.checked="true",r.classList.add("show-qty"),!document.querySelector(`.product p[data-part-id="${s}"]`)){let E=t.allowQuantity&&state[`${t.id}_qty`][s]||1,_=el("p");_.dataset.partId=s,_.dataset.spec=t.id,_.textContent=t.allowQuantity?`${e.name} \xd7 ${E}`:e.name,productDiv.appendChild(_)}t.allowQuantity&&(state[`${t.id}_qty`][s]=state[`${t.id}_qty`][s]||1)}else{n.delete(s),r.dataset.checked="false",r.classList.remove("show-qty");let h=productDiv.querySelector(`p[data-part-id="${s}"]`);h&&h.remove(),t.allowQuantity&&(state[`${t.id}_qty`][s]=void 0);let m=r.querySelector(".qty");m&&(m.dataset.value="1",m.textContent="1")}state[t.id]=Array.from(n)}"c4"===t.id&&enforcePortsForC4(),"c3"===t.id&&getC3CurrentUnits()>2&&freeUpC3Units(2),updateCounters(),updateTotalCost(),"c2"===t.id&&(updateOutgoerAvailability(),enforcePortsForC4()),"c4"===t.id&&updateSpaceBar()}function handleQtyClick(t,e,a){let r=PICKERS.find(e=>e.id===t);if(!r||!r.allowQuantity)return;let l=pickersRoot.querySelector(`section[data-spec="${t}"] .swatch[data-part-id="${e}"]`);if(!l)return;let s=l.querySelector("input");if(!s.checked&&a>0){s.checked=!0,s.dispatchEvent(new Event("change",{bubbles:!0}));return}let o=state[`${t}_qty`]||{},c="number"==typeof o[e]?o[e]:1,n=c+a;if(n<=0){s.checked=!1,s.dispatchEvent(new Event("change",{bubbles:!0}));return}if("c4"===t){let d=findPaletteEntryByPartID(OUTGOER_LESSTHAN_125A_TYPES,e),i=d&&d.spaceRequired||1,p=calculateUsedPortsForC4Model(),u=getTotalPorts();if(p+(n-c)*i>u)return}else if("c3"===t){let C=getC3CurrentUnits();if(C+(n-c)>2)return}state[`${t}_qty`][e]=n;let y=l.querySelector(".qty");y&&(y.dataset.value=String(n),y.textContent=String(n));let P=document.querySelector(`.product p[data-part-id="${e}"]`);if(P){let S=findPaletteEntryByPartID(r.palette,e)||findPaletteEntryByPartID(OUTGOER_LESSTHAN_125A_TYPES,e)||findPaletteEntryByPartID(OUTGOER_125A_OR_MORE_TYPES,e);S&&(P.textContent=`${S.name} \xd7 ${n}`)}updateSpaceBar(),updateTotalCost(),updateCounters()}function freeUpC3Units(t){for(;getC3CurrentUnits()>t&&state.c3.length>0;){let e=state.c3.shift();state.c3_qty&&(state.c3_qty[e]=void 0);let a=document.querySelector(`.product p[data-part-id="${e}"]`);a&&a.remove();let r=pickersRoot.querySelector(`section[data-spec="c3"] .swatch[data-part-id="${e}"]`);if(r){let l=r.querySelector("input");l&&(l.checked=!1),r.dataset.checked="false",r.classList.remove("show-qty");let s=r.querySelector(".qty");s&&(s.dataset.value="1",s.textContent="1")}}}function enforcePortsForC4(){let t=getTotalPorts(),e=calculateUsedPortsForC4Model();for(;e>t&&state.c4.length>0;){let a=state.c4.shift();state.c4_qty&&(state.c4_qty[a]=void 0);let r=document.querySelector(`.product p[data-part-id="${a}"]`);r&&r.remove();let l=pickersRoot.querySelector(`section[data-spec="c4"] .swatch[data-part-id="${a}"]`);if(l){let s=l.querySelector("input");s&&(s.checked=!1),l.dataset.checked="false",l.classList.remove("show-qty");let o=l.querySelector(".qty");o&&(o.dataset.value="1",o.textContent="1")}e=calculateUsedPortsForC4Model()}updateCounters(),updateTotalCost(),updateDownloadButtonState()}function updateOutgoerAvailability(){let t=PICKERS.find(t=>"c3"===t.id),e=pickersRoot.querySelector('section[data-spec="c3"]');if(!e||!t)return;let a=state.c2[0],r=!1;if(a){let l=findPaletteEntryByPartID(SPINE_TYPES,a);l&&l.supportsLargeOutgoer&&(r=!0)}e.querySelectorAll(".swatch").forEach(t=>{if(r)t.classList.remove("disabled"),t.dataset.disabled="false";else{if("true"===t.dataset.checked){let e=t.querySelector("input");if(e){let a=e.value;e.checked=!1,t.dataset.checked="false";let l=document.querySelector(`.product p[data-part-id="${a}"]`);l&&l.remove()}}t.classList.add("disabled"),t.dataset.disabled="true"}}),r||(Array.isArray(state.c3)&&state.c3.forEach(t=>{state.c3_qty&&(state.c3_qty[t]=void 0)}),state.c3=[]),updateSpaceBar(),updateBlanksDisplay(),updateCounters(),updateDownloadButtonState()}function updateCounters(){PICKERS.forEach(t=>{let e=document.getElementById(`count-${t.id}`);e&&("c4"===t.id?e.textContent=String(calculateUsedPortsForC4Model()):"c3"===t.id?e.textContent=String(getC3CurrentUnits()):e.textContent=String(state[t.id].length))}),updateTotalCost()}function updateTotalCost(){let t=0;PICKERS.forEach(e=>{let a=e.palette||[];state[e.id].forEach(r=>{let l=findPaletteEntryByPartID(a,r);if(!l)return;let s=1;e.allowQuantity&&state[`${e.id}_qty`]&&(s=state[`${e.id}_qty`][r]||1),t+=(l.cost||0)*s})});let e=document.getElementById("total-cost");e&&(e.textContent=`Total Cost: \xa3${t}`),updateDownloadButtonState()}function updateDownloadButtonState(){if(!downloadBtn)return;let t=calculateUsedPortsForC4Model(),e=getTotalPorts(),a=productDiv&&productDiv.querySelectorAll("p").length>0,r=t>e||!a;downloadBtn.disabled=r,downloadBtn.style.pointerEvents=r?"none":"",downloadBtn.style.opacity=r?"0.45":""}function downloadCSV(){if(!productDiv||calculateUsedPortsForC4Model()>getTotalPorts())return;let t=Array.from(productDiv.querySelectorAll("p")).map(t=>`"${t.textContent.replace(/\u00d7/g,"x")}"`),e=t.join("\n"),a=new Blob([e],{type:"text/csv"}),r=URL.createObjectURL(a),l=el("a");l.href=r,l.download="products.csv",document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(r)}function resetApp(){state.c1=[],state.c2=[],state.c3=[],state.c4=[],state.c5=[],PICKERS.forEach(t=>{t.allowQuantity&&(state[`${t.id}_qty`]={})}),renderPickers(),productDiv&&(productDiv.innerHTML=""),updateOutgoerAvailability(),updateTotalCost(),updateDownloadButtonState()}resetBtn?.addEventListener("click",resetApp),downloadBtn?.addEventListener("click",downloadCSV),renderPickers(),updateOutgoerAvailability(),updateSpaceBar(),updateBlanksDisplay(),updateDownloadButtonState();
