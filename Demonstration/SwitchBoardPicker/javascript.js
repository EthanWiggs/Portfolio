const INCOMER_TYPES=[{partID:"PB3153/ICM",name:"400A 3 POLE PANEL BOARD INCOMER"},{partID:"PB3154/ICM",name:"400A 4 POLE PANEL BOARD INCOMER"},{partID:"PB4003/ICM",name:"400A 3 POLE PANEL BOARD INCOMER"},{partID:"PB4004/ICM",name:"400A 4 POLE PANEL BOARD INCOMER"},{partID:"PB3154/ICS",name:"400A 4 POLE PANEL BOARD SWITCH INCOMER"}],SPINE_TYPES=[{partID:"PB400/06",name:"400A PANEL BOARD 6TP WAYS"},{partID:"PB400/06+2",name:"400A PANEL BOARD 6+2 TP WAYS",supportsLargeOutgoer:!0},{partID:"PB400/08",name:"400A PANEL BOARD 8TP WAYS"},{partID:"PB400/08+2",name:"400A PANEL BOARD 8+2 TP WAYS",supportsLargeOutgoer:!0},{partID:"PB400/12",name:"400A PANEL BOARD 12TP WAY"},{partID:"PB400/12+2",name:"400A PANEL BOARD 12+2 TP WAY",supportsLargeOutgoer:!0},{partID:"PB400/16",name:"400A PANEL BOARD 16TP WAY"},{partID:"PB400/16+2",name:"400A PANEL BOARD 16+2 TP WAY",supportsLargeOutgoer:!0}],OUTGOER_LESSTHAN_125A_TYPES=[{partID:"MC3P160",name:"MCCB 3P 160A"},{partID:"MC3P200",name:"MCCB 3P 200A"},{partID:"MC3P250",name:"MCCB 3P 250A"}],OUTGOER_125A_OR_MORE_TYPES=[{partID:"MC1P016",name:"MCCB 1P 16A"},{partID:"MC1P020",name:"MCCB 1P 20A"},{partID:"MC1P025",name:"MCCB 1P 25A"},{partID:"MC1P032",name:"MCCB 1P 32A"},{partID:"MC1P040",name:"MCCB 1P 40A"},{partID:"MC1P050",name:"MCCB 1P 50A"},{partID:"MC1P063",name:"MCCB 1P 63A"},{partID:"MC1P080",name:"MCCB 1P 80A"},{partID:"MC1P100",name:"MCCB 1P 100A"},{partID:"MC1P125",name:"MCCB 1P 125A"},{partID:"MC3P025",name:"MCCB 3P 25A"},{partID:"MC3P040",name:"MCCB 3P 40A"},{partID:"MC3P063",name:"MCCB 3P 63A"},{partID:"MC3P100",name:"MCCB 3P 100A"},{partID:"MC3P125",name:"MCCB 3P 125A"}],ACCESSORIES=[{partID:"PB/SPD-100KA",name:"SURGE KIT TYPE 1+2"},{partID:"PB400-MID",name:"SINGLE METER KIT"},{partID:"PB/SB",name:"SINGLE POLE BLANK"},{partID:"PB/TB",name:"TRIPLE POLE BLANK"},{partID:"PB/KL",name:"KEY LOCK"},{partID:"PB400/AB",name:"TYPE A ACCESSORY BOX"},{partID:"PB400/EB",name:"EXTENSION BOX"},],PICKERS=[{id:"c1",title:"Incomer – Choose one only",type:"single",palette:INCOMER_TYPES},{id:"c2",title:"Spine – Choose one only",type:"single",palette:SPINE_TYPES},{id:"c3",title:"Outgoer > 125A - Maximum 2 Units",type:"multi",max:2,palette:OUTGOER_LESSTHAN_125A_TYPES,allowQuantity:!0},{id:"c4",title:"Outgoer ≤ 125A",type:"multi",max:15,palette:OUTGOER_125A_OR_MORE_TYPES,allowQuantity:!0},{id:"c5",title:"Accessories",type:"multi",max:7,palette:ACCESSORIES},],state={c1:[],c2:[],c3:[],c4:[],c5:[]},pickersRoot=document.getElementById("pickers");function findPaletteEntryByPartID(e,t){return Array.isArray(e)&&e.find(e=>e.partID===t||e.partId===t||e.id===t)||null}function setSwatchDisabled(e,t){if(!e)return;let a=e.querySelector("input");t?(e.classList.add("disabled"),e.dataset.disabled="true",a&&(a.disabled=!0),e.style.pointerEvents="none",e.style.opacity=".45"):(e.classList.remove("disabled"),e.dataset.disabled="false",a&&(a.disabled=!1),e.style.pointerEvents="",e.style.opacity="")}function enforceMax(e){let t=Math.max(1,e.max||1),a=state[e.id];if(!Array.isArray(a))return;let l=pickersRoot.querySelector(`section[data-spec="${e.id}"]`);for(;a.length>t;){let r=a.shift();l&&l.querySelectorAll(".swatch").forEach(e=>{let t=e.querySelector("input");if(t&&t.value===r){e.dataset.checked="false",t.checked=!1;let a=e.querySelector(".qty-wrap");a&&(a.style.visibility="hidden")}});let i=document.querySelector(`.product p[data-part-id="${r}"]`);i&&i.remove(),e.allowQuantity&&(state[`${e.id}_qty`][r]=void 0)}state[e.id]=a,updateCounters()}function updateOutgoerAvailability(){let e=PICKERS.find(e=>"c3"===e.id);if(!e)return;let t=pickersRoot.querySelector('section[data-spec="c3"]');if(!t)return;let a=t.querySelector(".swatch-grid"),l=state.c2[0],r=!1;if(l){let i=null;void 0!==SPINE_TYPES&&(i=findPaletteEntryByPartID(SPINE_TYPES,l)),i&&i.supportsLargeOutgoer?r=!0:"undefined"!=typeof SPINE_SUPPORTS_LARGE_OUTGOERS&&SPINE_SUPPORTS_LARGE_OUTGOERS.has(l)&&(r=!0)}a&&(a.querySelectorAll(".swatch").forEach(e=>{if(r)setSwatchDisabled(e,!1);else{if("true"===e.dataset.checked){let t=e.querySelector("input");if(t){let a=t.value;t.checked=!1,e.dataset.checked="false";let l=document.querySelector(`.product p[data-part-id="${a}"]`);l&&l.remove()}}setSwatchDisabled(e,!0)}}),r||(Array.isArray(state.c3)&&state.c3.forEach(t=>{e.allowQuantity&&(state[`${e.id}_qty`][t]=void 0)}),state.c3=[]),updateCounters())}function createSwatch(e,t,a,l,r={}){`${a}-${t}`.toLowerCase().replace(/\s+/g,"-");let i=document.createElement("label");i.className="swatch",i.dataset.checked="false",i.dataset.partId=e,i.title=`${t} (${e})`;let n=document.createElement("input");n.type="checkbox",n.name=a,n.value=e,n.className="swatch-input";let d=document.createElement("span");d.className="tick",d.textContent="✓";let c=document.createElement("span");if(c.className="swatch-label",c.textContent=t,i.appendChild(n),i.appendChild(d),i.appendChild(c),r.allowQuantity){let s=document.createElement("div");s.className="qty-wrap",s.style.visibility="hidden";let o=document.createElement("button");o.type="button",o.className="qty-minus",o.textContent="−",o.setAttribute("aria-label",`Decrease quantity for ${t}`);let p=document.createElement("span");p.className="qty",p.textContent="1",p.dataset.value="1";let u=document.createElement("button");u.type="button",u.className="qty-plus",u.textContent="+",u.setAttribute("aria-label",`Increase quantity for ${t}`),s.appendChild(o),s.appendChild(p),s.appendChild(u),i.appendChild(s)}return i}function renderPickers(){pickersRoot.innerHTML="",PICKERS.forEach(e=>{e.allowQuantity&&!state[`${e.id}_qty`]&&(state[`${e.id}_qty`]={});let t=document.createElement("section");t.className="section",t.dataset.spec=e.id;let a=document.createElement("h2");a.textContent=e.title,t.appendChild(a);let l=document.createElement("div");l.className="swatch-grid";let r=e.palette||[];r.forEach(t=>{let a=createSwatch(t.partID,t.name,e.id,"multi"===e.type,{allowQuantity:!!e.allowQuantity}),r=state[e.id].includes(t.partID);a.dataset.checked=r?"true":"false";let i=a.querySelector("input");if(i.checked=r,e.allowQuantity){let n=a.querySelector(".qty"),d=a.querySelector(".qty-wrap"),c=state[`${e.id}_qty`][t.partID]||1;n&&(n.dataset.value=String(c),n.textContent=String(c)),d&&(d.style.visibility=r?"visible":"hidden")}i.addEventListener("change",()=>{let r=document.querySelector(".product"),n=t.partID;if("single"===e.type){if(i.checked){state[e.id]=[n],l.querySelectorAll(".swatch").forEach(t=>{let a=t.querySelector("input").value;if(a===n)t.dataset.checked="true",t.querySelector("input").checked=!0;else{t.dataset.checked="false",t.querySelector("input").checked=!1,r.querySelectorAll(`p[data-part-id="${a}"]`).forEach(e=>e.remove());let l=t.querySelector(".qty-wrap");l&&(l.style.visibility="hidden"),e.allowQuantity&&(state[`${e.id}_qty`][a]=void 0)}}),r.querySelectorAll(`p[data-spec="${e.id}"]`).forEach(e=>e.remove());let d=document.createElement("p"),c=e.allowQuantity&&state[`${e.id}_qty`][n]||1;d.textContent=e.allowQuantity?`${t.name} \xd7 ${c}`:t.name,d.dataset.partId=n,d.dataset.spec=e.id,r.appendChild(d);let s=a.querySelector(".qty-wrap");s&&(s.style.visibility="visible"),e.allowQuantity&&(state[`${e.id}_qty`][n]=state[`${e.id}_qty`][n]||1)}else{state[e.id]=[],r.querySelectorAll(`p[data-part-id="${n}"]`).forEach(e=>e.remove()),a.dataset.checked="false";let o=a.querySelector(".qty-wrap");o&&(o.style.visibility="hidden")}}else{let p=new Set(state[e.id]);if(i.checked){if(p.size>=(e.max||2)){let u=state[e.id][0];p.delete(u),l.querySelectorAll(".swatch").forEach(t=>{let a=t.querySelector("input").value;if(a===u){t.dataset.checked="false",t.querySelector("input").checked=!1;let l=document.querySelector(`.product p[data-part-id="${u}"]`);l&&l.remove();let r=t.querySelector(".qty-wrap");r&&(r.style.visibility="hidden"),e.allowQuantity&&(state[`${e.id}_qty`][u]=void 0)}})}p.add(n),a.dataset.checked="true";let y=document.querySelector(`.product p[data-part-id="${n}"]`);if(!y){let C=document.createElement("p"),$=e.allowQuantity&&state[`${e.id}_qty`][n]||1;C.textContent=e.allowQuantity?`${t.name} \xd7 ${$}`:t.name,C.dataset.partId=n,C.dataset.spec=e.id,document.querySelector(".product").appendChild(C)}let m=a.querySelector(".qty-wrap");m&&(m.style.visibility="visible"),e.allowQuantity&&(state[`${e.id}_qty`][n]=state[`${e.id}_qty`][n]||1)}else{p.delete(n),a.dataset.checked="false";let E=r.querySelector(`p[data-part-id="${n}"]`);E&&E.remove();let P=a.querySelector(".qty-wrap");P&&(P.style.visibility="hidden"),e.allowQuantity&&(state[`${e.id}_qty`][n]=void 0)}state[e.id]=Array.from(p)}updateCounters(),"c2"===e.id&&updateOutgoerAvailability()});let s=a.querySelector(".qty-plus"),o=a.querySelector(".qty-minus");s&&o&&(s.addEventListener("click",l=>{l.preventDefault();let r=a.querySelector(".qty"),i=Number(r.dataset.value||"1"),n=state[`${e.id}_qty`]||{},d=Object.values(n).reduce((e,t)=>e+(t||0),0),c=e.max||1;if(d>=c)return;let s=i+1;r.dataset.value=String(s),r.textContent=String(s),n[t.partID]=s;let o=document.querySelector(`.product p[data-part-id="${t.partID}"]`);o&&(o.textContent=`${t.name} \xd7 ${s}`)}),o.addEventListener("click",l=>{l.preventDefault();let r=a.querySelector(".qty"),i=Number(r.dataset.value||"1");if(i<=1){let n=a.querySelector("input");n&&(n.checked=!1,n.dispatchEvent(new Event("change",{bubbles:!0})));return}i-=1,r.dataset.value=String(i),r.textContent=String(i);let d=state[`${e.id}_qty`];d[t.partID]=i;let c=document.querySelector(`.product p[data-part-id="${t.partID}"]`);c&&(c.textContent=`${t.name} \xd7 ${i}`)})),l.appendChild(a)}),t.appendChild(l);let i=document.createElement("div");i.className="field-note";let n=document.createElement("span");if(n.innerHTML=`Selected: <strong id="count-${e.id}">${state[e.id].length}</strong> / ${e.max||("multi"===e.type?2:1)}`,i.appendChild(n),"multi"===e.type){let d=document.createElement("div");d.className="max-label",d.style.color="var(--muted)",d.style.fontSize="12px",d.textContent=`Max selectable: ${e.max||2}`,i.appendChild(d)}t.appendChild(i),pickersRoot.appendChild(t)})}function updateCounters(){PICKERS.forEach(e=>{let t=document.getElementById(`count-${e.id}`);t&&(t.textContent=String(state[e.id].length))})}function reset(){state.c1=[],state.c2=[],state.c3=[],state.c4=[],state.c5=[],PICKERS.forEach(e=>{e.allowQuantity&&(state[`${e.id}_qty`]={})}),renderPickers();let e=document.querySelector(".product");if(e)for(;e.firstChild;)e.removeChild(e.firstChild);updateOutgoerAvailability()}function downloadCSV(){let e=document.querySelector(".product");if(!e)return;let t=Array.from(e.querySelectorAll("p")).map(e=>{let t=e.textContent.replace(/\u00d7/g,"x");return`"${t}"`}),a=t.join("\n"),l=new Blob([a],{type:"text/csv"}),r=URL.createObjectURL(l),i=document.createElement("a");i.href=r,i.download="products.csv",document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(r)}document.getElementById("reset")?.addEventListener("click",reset),document.getElementById("download")?.addEventListener("click",downloadCSV),renderPickers(),updateOutgoerAvailability();